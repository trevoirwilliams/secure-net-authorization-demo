@page
@model SecureTaskHub.Web.Pages.AdminDashboardModel
@{
    ViewData["Title"] = "Admin Dashboard";
}

<div class="container mt-4">
    <h1 class="mb-4">
        <i class="bi bi-shield-lock"></i> Admin Dashboard
    </h1>
    
    @* @if (@User.IsInRole("User"))
    {
    } *@
    <div class="alert alert-warning" role="alert">
        <strong>Teaching Note:</strong> This page demonstrates a security gap.
        While we check the user's role in the page model code, this check happens
        AFTER the page is accessed. A proper implementation would use the
        <code>[Authorize(Roles = "Admin")]</code> attribute.
    </div>


        <p class="text-muted">
            Welcome, <strong>@User.Identity?.Name</strong> (Administrator)! 
            You can see all tasks from all users in the system.
        </p>

        <h2 class="mt-4 mb-3">All Tasks (System-Wide View)</h2>

        @if (Model.AllTasks.Any())
        {
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>ID</th>
                            <th>Title</th>
                            <th>Description</th>
                            <th>Status</th>
                            <th>Owner</th>
                            <th>Created</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var task in Model.AllTasks.OrderBy(t => t.OwnerUserId).ThenByDescending(t => t.CreatedAt))
                        {
                            <tr>
                                <td>@task.Id</td>
                                <td>@task.Title</td>
                                <td>@(task.Description ?? "(no description)")</td>
                                <td>
                                    <span class="badge bg-@(task.Status.ToString() switch
                                    {
                                        "New" => "primary",
                                        "InProgress" => "warning",
                                        "Done" => "success",
                                        _ => "secondary"
                                    })">
                                        @task.Status
                                    </span>
                                </td>
                                <td>
                                    <span class="badge bg-secondary">@task.OwnerUserId</span>
                                </td>
                                <td>@task.CreatedAt.ToLocalTime().ToString("yyyy-MM-dd HH:mm")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <div class="mt-3">
                <p class="text-info">
                    <strong>Total Tasks:</strong> @Model.AllTasks.Count
                </p>
            </div>
        }
        else
        {
            <div class="alert alert-info">
                <strong>No tasks found.</strong> The system doesn't have any tasks yet.
            </div>
        }
    
</div>
